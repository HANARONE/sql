```SQL
SELECT A.HISTORY_ID, TO_NUMBER(USE_DATE*DAILY_FEE*(1-(NVL(DISCOUNT_RATE,0)/100))) AS FEE
FROM (SELECT H.HISTORY_ID, C.CAR_ID, C.CAR_TYPE, C.DAILY_FEE,
             (END_DATE-START_DATE+1) AS USE_DATE,
             CASE WHEN (END_DATE-START_DATE+1) >= 90 THEN '90일 이상'
                  WHEN (END_DATE-START_DATE+1) >= 30 THEN '30일 이상'
                  WHEN (END_DATE-START_DATE+1) >= 7 THEN '7일 이상' 
                  ELSE '7일 미만' END AS DURATION_TYPE
      FROM CAR_RENTAL_COMPANY_CAR C,
           CAR_RENTAL_COMPANY_RENTAL_HISTORY H
      WHERE C.CAR_ID = H.CAR_ID
            AND C.CAR_TYPE = '트럭'
     ) A
LEFT JOIN CAR_RENTAL_COMPANY_DISCOUNT_PLAN D
ON A.CAR_TYPE = D.CAR_TYPE AND A.DURATION_TYPE = D.DURATION_TYPE
ORDER BY FEE DESC,HISTORY_ID DESC;
```

